<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ø°ÙƒØ±Ù†ÙŠ - Ø§Ù„Ù…Ù‡Ø§Ù…</title>

  <style>
    body {
      font-family: "Tajawal", sans-serif;
      background: #fff6ed;
      margin: 0;
      padding: 0;
      text-align: center;
    }

    header {
      background: #ff8800;
      color: white;
      padding: 15px;
      font-size: 22px;
      font-weight: bold;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    }

    #taskList {
      max-width: 500px;
      margin: 20px auto;
      padding: 0;
      list-style: none;
    }

    li {
      background: white;
      margin: 10px 0;
      padding: 15px;
      border-radius: 10px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      cursor: pointer;
      transition: 0.2s;
    }

    li:hover {
      transform: scale(1.03);
      background: #ffe7cc;
    }

    #refreshBtn {
      background: #ff8800;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
      margin-top: 10px;
    }
  </style>
</head>

<body>

<header>ðŸ“‹ Ù…Ù‡Ø§Ù…ÙŠ</header>

<button id="refreshBtn">ðŸ”„ ØªØ­Ø¯ÙŠØ«</button>

<ul id="taskList"></ul>

<script>
  const API_URL = "https://zkr-495g.onrender.com/tasks";
  const CODE = "ran/ran*78";

  // ÙƒÙˆØ¯ Ø§Ù„ØªÙØ¹ÙŠÙ„
  async function checkCode() {
    let entered = sessionStorage.getItem("auth");

    if (entered !== CODE) {
      entered = prompt("ðŸŸ  Ø£Ø¯Ø®Ù„ ÙƒÙˆØ¯ Ø§Ù„ØªÙØ¹ÙŠÙ„:");
      if (entered === CODE) {
        sessionStorage.setItem("auth", CODE);
      } else {
        alert("âŒ ÙƒÙˆØ¯ Ø®Ø§Ø·Ø¦!");
        location.reload();
      }
    }
  }

  // ØªØ®Ø²ÙŠÙ† Ù…Ø¹Ø±ÙØ§Øª Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ù…Ù†ØªÙ‡ÙŠØ©
  function loadFinished() {
    return JSON.parse(localStorage.getItem("finished") || "[]");
  }

  function saveFinished(list) {
    localStorage.setItem("finished", JSON.stringify(list));
  }

  // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù‡Ø§Ù…
  async function loadTasks() {
    try {
      const res = await fetch(API_URL);
      const tasks = await res.json();
      displayTasks(tasks);
    } catch (e) {
      console.log("Ø®Ø·Ø£:", e);
    }
  }

  // Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù‡Ø§Ù… Ø¨Ø¯ÙˆÙ† Ø³Ø¬Ù„
  function displayTasks(tasks) {
    const finished = loadFinished();
    const list = document.getElementById("taskList");
    list.innerHTML = "";

    tasks.forEach(task => {
      const key = `${task.id}-${task.text}`;

      if (!finished.includes(key)) {
        const li = document.createElement("li");
        li.innerHTML = `
          <strong>${task.subject}</strong><br>
          ${task.text}
        `;

        li.addEventListener("click", () => finishTask(key, li));

        list.appendChild(li);
      }
    });
  }

  // Ø¥Ù†Ù‡Ø§Ø¡ / Ø­Ø°Ù Ù…Ù‡Ù…Ø©
  function finishTask(key, element) {
    const finished = loadFinished();
    finished.push(key);
    saveFinished(finished);

    element.style.opacity = "0";
    setTimeout(() => element.remove(), 200);
  }

  document.getElementById("refreshBtn").onclick = () => loadTasks();

  // ØªØ´ØºÙŠÙ„ Ø£ÙˆÙ„ÙŠ
  checkCode();
  loadTasks();
  setInterval(loadTasks, 15000);
</script>

</body>
</html>
