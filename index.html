<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>قائمة المهام</title>
<style>
body {
  font-family: Arial;
  background: #f4f4f4;
  padding: 20px;
}
.container {
  width: 400px;
  margin: auto;
  background: white;
  padding: 20px;
  border-radius: 10px;
}
h2 {
  margin-top: 0;
}
.task {
  display: flex;
  align-items: center;
  margin-bottom: 10px;
  background: #fafafa;
  padding: 10px;
  border-radius: 6px;
}
.task input {
  width: 20px;
  height: 20px;
  margin-left: 10px;
}
#doneList li {
  padding: 5px 0;
  border-bottom: 1px solid #ddd;
}
</style>
</head>
<body>

<div class="container">
  <h2>المهام الجديدة</h2>
  <ul id="taskList"></ul>

  <h2>المهام المنجزة</h2>
  <ul id="doneList"></ul>
</div>

<script>
// =============================
// 1) تحميل المهام
// =============================
function loadTasks() {
  fetch("tasks.json") // غيّر هذا حسب رابط API
    .then(r => r.json())
    .then(data => displayTasks(data));
}

// =============================
// 2) عرض المهام الجديدة
// =============================
function displayTasks(tasks) {
  const list = document.getElementById("taskList");
  list.innerHTML = "";

  let done = JSON.parse(localStorage.getItem("doneTasks") || "[]");

  tasks.forEach(task => {
    const key = task.id + "-" + task.text;

    if (!done.includes(key)) {
      let li = document.createElement("li");
      li.className = "task";
      li.innerHTML = `
        <input type="checkbox" data-id="${task.id}">
        <div>${task.text}</div>
      `;
      list.appendChild(li);
    }
  });
}

// =============================
// 3) عند الضغط على المربع ✓
// =============================
document.addEventListener("change", e => {
  if (e.target.type === "checkbox") {
    let id = e.target.dataset.id;
    let text = e.target.closest("li").querySelector("div").innerText;
    markDone(id, text);
  }
});

// =============================
// 4) تسجيل المهمة كمنجزة
// =============================
function markDone(id, text) {
  let doneTasks = JSON.parse(localStorage.getItem("doneTasks") || "[]");

  const key = id + "-" + text;

  if (!doneTasks.includes(key)) {
    doneTasks.push(key);
    localStorage.setItem("doneTasks", JSON.stringify(doneTasks));
  }

  displayDoneTasks();
  loadTasks();
}

// =============================
// 5) عرض المهام المنجزة
// =============================
function displayDoneTasks() {
  let doneTasks = JSON.parse(localStorage.getItem("doneTasks") || "[]");
  const doneList = document.getElementById("doneList");
  doneList.innerHTML = "";

  doneTasks.forEach(key => {
    let li = document.createElement("li");
    li.innerText = key.split("-").slice(1).join("-");
    doneList.appendChild(li);
  });
}

// تشغيل أولي
displayDoneTasks();
loadTasks();
</script>

</body>
</html>
